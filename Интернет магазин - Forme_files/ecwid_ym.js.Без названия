var token="",ymCurrency="",ym_settings={},ecomm=!0,ym_configured=!0;!function(){Ecwid.OnAPILoaded.add(function(){if(!window.jQuery){var e=document.createElement("script");e.type="text/javascript",e.src="//code.jquery.com/jquery-2.1.4.min.js",document.getElementsByTagName("head")[0].appendChild(e)}var t=Ecwid.getAppPublicConfig("ya-metrika");t.length>0?(ym_settings=JSON.parse(t),ymCurrency=Ecwid.getStoreConfiguration().currency.code,"undefined"!=typeof ym_settings.ecommerce?window[ym_settings.ecommerce]=window[ym_settings.ecommerce]||[]:(console.log("Ecommerce не включен"),ecomm=!1),"undefined"==typeof ym_settings.id||"undefined"!=typeof Ya&&"undefined"!=typeof window["yaCounter"+ym_settings.id]||n(ym_settings)):ym_configured=!1}),Ecwid.OnCartChanged.add(function(t){if(ecomm){var n=e.get();e.set(t),changedProducts=r(t,n);for(var d=0;d<changedProducts.added.length;++d)jQuery.getJSON("https://app.ecwid.com/api/v1/"+Ecwid.getOwnerId()+"/product?id="+changedProducts.added[d]+"&callback=?",function(e,t){"undefined"!=typeof e.categories?category=e.categories[0].name:category="Store","undefined"!=typeof ym_settings.addToCartGoalId&&window["yaCounter"+ym_settings.id].reachGoal(ym_settings.addToCartGoalId),window[ym_settings.ecommerce].push({ecommerce:{currencyCode:ymCurrency,add:{products:[{name:e.name,id:e.sku,price:e.price,category:category,quantity:1}]}}})});for(var d=0;d<changedProducts.deleted.length;++d)jQuery.getJSON("https://app.ecwid.com/api/v1/"+Ecwid.getOwnerId()+"/product?id="+changedProducts.deleted[d]+"&callback=?",function(e,t){"undefined"!=typeof e.categories?category=e.categories[0].name:category="Store",Ecwid.Cart.get(function(t){0!=t.orderId&&window[ym_settings.ecommerce].push({ecommerce:{remove:{products:[{name:e.name,id:e.sku,price:e.price,category:category,quantity:1}]}}})})})}}),Ecwid.OnOrderPlaced.add(function(e){return ecomm?(e=c(e),void window[ym_settings.ecommerce].push({currencyCode:Ecwid.getStoreConfiguration().currency.code,ecommerce:{purchase:{actionField:{id:e.id,goal_id:ym_settings.goalId},products:e.products}}})):!1}),Ecwid.OnPageLoaded.add(function(e){if(!ym_configured||"undefined"==typeof window["yaCounter"+ym_settings.id])return!1;var n=t.get();switch(t.set(document.URL),window["yaCounter"+ym_settings.id].hit(document.URL,{title:o(e),referer:n}),e.type){case"PRODUCT":if(!ecomm)break;jQuery.getJSON("https://app.ecwid.com/api/v1/"+Ecwid.getOwnerId()+"/product?id="+e.productId+"&callback=?",function(e,t){var n="Store";"undefined"!=typeof e.categories&&(n=e.categories[0].name),window[ym_settings.ecommerce].push({ecommerce:{currencyCode:ymCurrency,detail:{products:[{id:e.sku,name:e.name,price:e.price,category:n}]}}})})}});var e={set:function(e){e&&("object"==typeof e&&(e=JSON.stringify(e)),localStorage.setItem("ym_prev_cart",e))},get:function(){var e=localStorage.getItem("ym_prev_cart");if(e)return"{"===e[0]&&(e=JSON.parse(e)),e}},t={set:function(e){e&&("object"==typeof e&&(e=JSON.stringify(e)),localStorage.setItem("ym_prev_page",e))},get:function(){var e=localStorage.getItem("ym_prev_page");if(e)return"{"===e[0]&&(e=JSON.parse(e)),e}},n=function(e){!function(t,n,r){(n[r]=n[r]||[]).push(function(){try{n["yaCounter"+e.id]=new Ya.Metrika(e)}catch(t){}});var d=t.getElementsByTagName("script")[0],c=t.createElement("script"),o=function(){d.parentNode.insertBefore(c,d)};c.type="text/javascript",c.async=!0,c.src="https://mc.yandex.ru/metrika/watch.js","[object Opera]"==n.opera?t.addEventListener("DOMContentLoaded",o,!1):o()}(document,window,"yandex_metrika_callbacks")},r=function(e,t){var n=e.items;pp2="undefined"==typeof t?{}:t.items;for(var r=n.length,c={added:[],deleted:[]},o=0;r>o;o++){found=!1;for(var i=0;i<pp2.length;i++)if(n[o].product.id==pp2[i].product.id){n[o].quantity!=pp2[i].quantity&&(d(n[o].quantity,pp2[i].quantity)>0?c.added.push(n[o].product.id):c.deleted.push(n[o].product.id)),pp2.splice(i,1),found=!0;break}found||c.added.push(n[o].product.id)}for(var i=0;i<pp2.length;i++)c.deleted.push(pp2[i].product.id);return c},d=function(e,t){return"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),e-t},c=function(e){for(var t=[],n={},r=0;r<e.items.length;++r)t.push({id:e.items[r].product.sku,name:e.items[r].product.name,quantity:e.items[r].quantity,price:e.items[r].product.price});return n.products=t,n.id=e.orderNumber,n.revenue=e.total,n},o=function(e){return document.title}}();